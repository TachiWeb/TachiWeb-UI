<!-- Search bar that overlays the toolbar. Drops down from the top of the page.-->
<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-material/paper-material.html">
<link rel="import" href="/bower_components/iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/neon-animation/neon-animations.html">
<link rel="import" href="/src/behavior/localized-app-behavior.html">

<dom-module id="material-search">
  <template>
      <style is="custom-style">
          :host {
              width: 100%;
              top: 0;
          }
          #search_box {
              background: white;
              padding: 0 5px;
              margin: 8px;
              height: calc(64px - 8px - 8px);
              border-radius: 2px;
          }
          #search_input {
              --paper-input-container: {
                padding: 0;
              }
          }
          #search_close {
              margin: 5px;
              color: black;
              opacity: var(--dark-disabled-opacity, 0.38);
              float: left;
          }
      </style>
      <paper-material id="search_box" elevation="1">
        <paper-icon-button id="search_close" icon="icons:arrow-back"></paper-icon-button>
        <paper-input id="search_input" label="{{localize('material_search_label')}}" value="{{value}}" always-float-label>
        </paper-input>
      </paper-material>
  </template>

  <script>
    Polymer({
      is: 'material-search',
      behaviors: [
          LocalizedAppBehavior,
          Polymer.IronOverlayBehavior,
          Polymer.NeonAnimationRunnerBehavior
      ],
      listeners: {
          'iron-overlay-opened': '_initSearch',
          'iron-overlay-canceled': '_destroySearch',
          'neon-animation-finish': '_closeSearch',
          'search_close.tap': 'closeSearch'
      },
      properties: {
        value: {
          type: String,
          notify: true,
          value: ''
        },
        animationConfig: {
          value: function() {
            return {
              'entry': [{
                name: 'slide-from-top-animation',
                node: this
              }, {
                name: 'fade-in-animation',
                node: this
              }],
              'exit': [{
                name: 'slide-up-animation',
                node: this
              }, {
                name: 'fade-out-animation',
                node: this
              }]
            }
          }
        },
        noCancelOnOutsideClick: {
          value: true
        }
      },
      _initSearch: function() {
        this.playAnimation('entry');
        this.$.search_input.$.input.focus(); //Autofocus attribute does not work on paper-input for some reason
      },
      _destroySearch: function(event) {
        if(event !== undefined && event !== null) {
          event.preventDefault(); //Do not close overlay for now
        }
        //Do not play animation if we are already animating
        if(!this._queueExit) {
          this.playAnimation('exit');
          this._queueExit = true;
        }
      },
      _closeSearch: function(event) {
        //Check if this is the exit animation
        if(this._queueExit) {
          this._queueExit = false;
          this.close();
        }
      },
      closeSearch: function() {
        this._destroySearch();
      }
    });
  </script>
</dom-module>
